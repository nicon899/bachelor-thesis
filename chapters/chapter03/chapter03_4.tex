\section{Entwurf der Cloud-BI Architektur} \label{sec:entwurfBIArchitektur}
Mit den gewonnenen Erkenntnissen über die verschiedenen Azure Dienste wird aus diesen eine geeignete Auswahl für das Cloud-BI System getroffen und anschließend eine vollständige Architektur entworfen.

\subsection{Auswertung der Evaluation} \label{sec:konzeption:evaAuswertung}
 Eine zusammenfassende Einschätzung der Dienste in Bezug auf die Anforderungen kann in den Tabellen \ref{table:eva} und \ref{table:eva2} gefunden werden. In Tabelle~\ref{table:eva} werden Anforderungen, die bestimmten Aufgabenbereichen im BI-System zugeordnet werden können, betrachtet. Tabelle~\ref{table:eva2} enthält weitere relevante Anforderungen, die unabhängig davon sind, wofür ein Dienst eingesetzt wird.
 
Die Grundlage für die Auswahl der Dienste, die in der Cloud BI-Architektur verwendet werden sollen, bilden die abzudeckenden Aufgabenbereiche. Die Auswahl wird im Folgenden erläutert:
\begin{itemize}
\item \textbf{Datenspeicherung}: Für die Speicherung der Daten soll die \textit{SQL Database} verwendet werden. Diese eignet sich, weil alle Daten aus den Quellsystemen entweder bereits relational sind oder in ein relationales Format transformiert werden können. Besonders in Hinsicht auf das aktuelle BI-System ist die Verwendung einer SQL-Datenbank attraktiv, weil die Migration dadurch vereinfacht wird und vorhandenes Wissen weiterhin in der Praxis eingesetzt werden kann. Naheliegende Alternativen wären die \textit{SQL Managed Instance}, welche mehr Kontrolle über den SQL-Server bietet, oder \textit{Synapse Analytics}. Beide bieten zusätzliche Funktionen in den Aufgabenbereichen \textit{Datenintegration und -verarbeitung}, für die es allerdings jeweils bessere Optionen gibt. Wird nur die Datenspeicherung betrachtet, ist die \textit{SQL Database} die Lösung mit der geringsten Komplexität und wird deswegen bevorzugt.

\item \textbf{Datenintegration}: Zunächst sollen einige Dienste ausgeschlossen werden. Die \textit{SQL Managed Instance} kann verlinkte Datenbanken abfragen, allerdings keine \ac{rest}-\ac{api} und ist damit, im Gegensatz zu den anderen Diensten, nicht alleine ausreichend für die Datenintegration. Die \ac{adf} und \textit{Synapse Analytics} haben den entscheidenden Nachteil, dass sie nicht direkt auf die \textit{SQL-Database} zugreifen können, wenn sich diese in einem virtuellen Netzwerk befindet, sondern dafür eine zusätzliche \ac{vm} in Azure erforderlich wäre \cite{msdoc_22_adf_integrationRuntime}.

Damit stehen noch \textit{Logic Apps} und \textit{Functions} zur Auswahl, welche hier als gleichwertig einzuordnen sind. Da \textit{Functions} den Vorteil hat, dass es auch lokal entwickelt und getestet werden kann, wird dieser Dienst ausgewählt. Hierbei ist jedoch die nicht-funktionale Anforderung, dass aufgetretene Fehler leicht nachvollziehbar sein sollen, zu berücksichtigen, welche mit der aktuellen Auswahl nicht erfüllt wird. Diese Problematik kann durch die Ergänzung von \textit{Application Insight} gelöst werden. Dies ist ein Monitoring Dienst, der mit \textit{Functions} verknüpft werden kann. Dadurch steht beim Programmieren der Funktionen ein Logger-Objekt zur Verfügung, welches Informationen oder Fehler an \textit{Application Insights} sendet. Dieses Logging ist über das \textit{Azure Portal} einsehbar. Außerdem können basierend auf den Logs automatische E-Mail-Benachrichtigungen gesendet werden \cite[vgl.][]{satapathi_hands-azure_2021}.

\item \textbf{Datenverarbeitung}: Mit den Verarbeitungsmöglichkeiten von \textit{T~=SQL} und \textit{Power BI} können Daten transformiert und ausgewertet werden, deswegen ist die Verwendung von \ac{aas} als Semantik-Schicht zwischen Datenbank und Reporting nicht notwendig. Um zukünftig fortgeschrittene Analysen mit Python und R zu ermöglichen, wird \ac{aml} vorgesehen, weil damit am meisten Möglichkeiten zur Verfügung stehen. \textit{Synapse Analytics} würde nur Python unterstützen und die \textit{SQL Managed Instance} ist auf wenige Algorithmen beschränkt \cite{etaati_introduction_2019}.
Da im Bestandssystem keine vergleichbare Funktionalität existiert, ist \ac{aml} für eine Migration nicht zwingend erforderlich, weswegen der Dienst zunächst ausgelassen wird. Ein Ausblick auf eine mögliche Ergänzung wird in Abschnitt~\ref{sec:praktischeUmsetzung:ausblick:aml} gegeben.
\item \textbf{Reporting}: Der einzige betrachtete Dienst zum Bereitstellen von Reports ist \textit{Power BI} und wird daher verwendet.
\item \textbf{Datengovernance}: Als Datengovernance-Tool kann \textit{Purview} für die Datenklassifizierung und eine automatische Datenflussdokumentation genutzt werden. Wie Tabelle~\ref{table:eva} zu entnehmen ist, ist \textit{Purview} ebenfalls alternativlos.
\end{itemize}
 
 Damit ist das Ergebnis der Evaluation, dass die Dienste \textit{SQL Database}, \textit{Functions}, \textit{Application Insights}, \textit{Purview} und \textit{Power BI} im neuen Cloud BI-System eingesetzt werden sollen. Das ist mit Blick auf Tabelle~\ref{table:eva} nicht selbstverständlich, da die vermeintlich am besten bewerteten Dienste, wie \textit{Synpase Analytics}, nicht gewählt wurden. Wie oben jedoch beschrieben wurde, gibt es für die einzelnen Anforderungen jeweils besser geeignete Optionen, die hier bevorzugt wurden. Das hat außerdem den Vorteil, dass eine modulare Infrastruktur entsteht, bei der es vergleichsweise einfach ist, neue Ressourcen hinzuzufügen oder vorhandene auszutauschen. Sollte in Zukunft beispielsweise die Anforderung entstehen, dass unstrukturierte Daten gespeichert werden sollen, könnte das System um einen \textit{Data Lake} ergänzt werden, ohne dass grundlegende Änderungen notwendig sind.

\input{chapters/chapter03/chapter03_3_evaTable}
\input{chapters/chapter03/chapter03_3_evaTable2}

\subsection{Vorstellung der Architektur}
Die Grundidee für die neue BI-Architektur wird in Abbildung~\ref{fig:chap03_4_konzeptArchitektur_offen} gezeigt. Neben den zuvor ausgewählten Ressourcen wurden die in Abschnitt~\ref{subsec:grundlagen:azure:sicherheitUndDatenschutz} vorgestellten Sicherheitsdienste ergänzt. Da \textit{Azure Policy} und das \ac{aad} Funktionen der \textit{Azure Cloud} sind, die implizit mit allen Ressourcen zusammenhängen, wurden zum Erhalten der Übersichtlichkeit keine Verbindungen eingezeichnet.

\begin{figure}[htbp]
 \centering
 \includegraphics[width=\textwidth]{gfx/konzept_1.png}
 \caption{Vereinfachtes Konzept für Azure BI-Architektur}
\label{fig:chap03_4_konzeptArchitektur_offen}
\end{figure}

Das Konzept sieht die Verwendung von der \textit{SQL Database} als zentralen Speicherort vor. In diese werden alle Daten aus dem on-premise \ac{dwh} migriert. In \textit{Functions} werden Funktionen implementiert, die sich mit den verschiedenen Quellsystemen verbinden, die Daten extrahieren, transformieren und in die \textit{SQL Database} laden. Passwörter und Schlüssel, die für die Authentifizierung benötigt werden, können dabei aus dem \textit{Key Vault} geladen werden. Bei der Ausführung werden ausführliche Logging-Informationen an \textit{Application Insisghts} gesendet. Wenn ein Fehler protokolliert wird, wird daraufhin automatisch eine E-Mail-Benachrichtigung versendet. Reports können zukünftig mit \textit{Power BI} erstellt und geteilt werden. Die verwendeten Daten werden aus dem Cloud \ac{dwh} geladen. \textit{Purview} sammelt Metadaten über die Datenlandschaft und erleichtert damit die Umsetzung eines DSGVO-konformen BI-Systems. Mit \textit{Azure Policy} wird verhindert, dass Ressourcen Konfiguration erhalten, die gegen eine Compliance verstoßen würden. Das \ac{aad} ist für die Authentifizierung und Autorisierung zuständig. Durch ein \ac{rbac}-Konzept wird sichergestellt, dass nur berechtige Personen Zugriff auf bestimmte Ressourcen oder Daten haben. 

Dieses Konzept ist jedoch noch nicht ausreichend, um den Sicherheitsanforderungen gerecht zu werden, da vorausgesetzt wird, dass alle Ressourcen miteinander kommunizieren können. Dies ist nur der Fall, wenn auf schützende Firewall-Regeln verzichtet wird, was offensichtlich keine Option ist. Stattdessen sollen alle Ressourcen durch eine Firewall gesichert werden und die Kommunikation durch einige notwendige Ergänzungen ermöglicht werden. Das vollständige Konzept für die BI-Architektur, unter Berücksichtigung der Netzwerksicherheit, kann in Abbildung~\ref{fig:chap03_4_konzeptArchitektur} gefunden werden.
 
 \begin{figure}[htbp]
 \centering
 \includegraphics[width=\textwidth]{gfx/konzept_2.png}
 \caption{Konzept für Azure BI-Architektur}
\label{fig:chap03_4_konzeptArchitektur}
\end{figure}

Die Grundlage bildet ein virtuelles Netzwerk für \textit{Functions} und das \ac{dwh}. Mit einer zusätzlichen \ac{vm} in diesem virtuellen Netzwerk, auf der zwei Anwendungen installiert werden, kann es den Diensten \textit{Power BI} und \textit{Purview} ermöglicht werden, indirekt auf das geschützte \ac{dwh} zuzugreifen \cite[vgl.][]{gunnarsson_pro_2020, msdoc_22_purviewSHIR}. Für \textit{Functions} wird eine statische IP-Adresse eingerichtet, sodass nur diese in Firewall-Einstellungen zugelassen werden muss. Wegen einer Unternehmensvorgabe darf die Firewall des on-premise Servers nicht verändert werden. Trotzdem kann die Datenintegration ermöglicht werden, indem die Anwendung \textit{Hybrid Connection Manager} eingesetzt wird,  da damit nur noch ausgehende Verbindungen vom on-premise Server notwendig sind \cite[vgl.][]{msdoc_22_func_hybridConn}.

Zusammengefasst wurden in diesem Kapitel geeignete Azure Dienste für das BI-System, basierend auf der Anforderungsspezifikation, ausgewählt und zu einem Gesamtkonzept kombiniert, dass den Sicherheitsanforderungen genügt. Im nächsten Schritt wird dieses Konzept in der Praxis umgesetzt und erprobt.