\section{Entwurf eines vollständigen Konzepts} \label{sec:entwurfBIArchitektur}

\subsection{Auswertung der Evaluation} \label{sec:konzeption:evaAuswertung}
Mit den gewonnenen Erkenntnissen über die verschiedenen Azure Dienste, soll eine geeignete Auswahl für das Cloud-BI System getroffen werden. Eine zusammenfassende Einschätzung der Dienste in Bezug auf die Anforderungen kann in Tabelle~\ref{table:eva} gefunden werden. In den letzten drei Zeilen wird in Summen angeben, wie viele funktionale Anforderungen erfüllt werden und darauf basierend, die Anzahl der nicht-funktionalen Anforderungen, die erfüllt beziehungsweise nicht erfüllt werden.
\input{chapters/chapter03/chapter03_3_evaTable}

In Tabelle~\ref{table:eva} ist zu erkennen, dass \textit{Power BI} und \textit{Purview} alternativlos sind und um alle Anforderungen zu erfüllen. \textit{Power BI} bietet die benötigten Reporting-Funktionalitäten und Purview kann als Datengovernance-Tool für die Datenklassifizierung und eine automatische Datenflussdokumentation genutzt werden. Für die weiteren funktionalen Anforderungen gibt es mehrere Möglichkeiten. 

Für die Speicherung der Daten soll die \textit{SQL Database} verwendet werden. Diese eignet sich, weil alle Daten aus den Quellsystemen entweder bereits relational sind oder in ein relationales Format transformiert werden können. Besonders in Hinsicht auf das aktuelle BI-System ist die Verwendung von \textit{Azure SQL} attraktiv, weil die Migration dadurch vereinfacht wird und vorhandenes Wissen weiterhin in der Praxis eingesetzt werden kann. Die naheliegendste Alternative wäre die \textit{Azure Managed Instance}, welche mehr Funktionen und Kontrolle über den SQL-Server bietet. Jedoch ist letzteres nicht zwangsläufig erforderlich und die zusätzlichen Funktionen, die benötigt werden, können mit anderen Diensten abgedeckt werden. Dadurch soll eine modulare Infrastruktur entstehen, bei der es möglichst einfach ist, neue Ressourcen hinzuzufügen oder vorhandene auszutauschen. Sollte in Zukunft zum Beispiel die Anforderung entstehen, dass unstrukturierte Daten gespeichert werden sollen, könnte das System um einen \textit{Data Lake} ergänzt werden, ohne dass grundlegende Änderungen notwendig sind.

Damit stehen auch die Verarbeitungsmöglichkeiten von T-SQL zur Verfügung. Deswegen wird aktuell keine Verwendung von \ac{aas} als Semantik-Schicht zwischen Datenbank und Reporting vorgesehen. Allerdings folgt daraus, dass \textit{Azure Machine Learning} verwendet werden muss, um das maschinelle Lernen mit Python und R zu ermöglichen.

Für die Datenintegration stehen \textit{Logic Apps}, \textit{Functions} und \ac{adf} zur Auswahl. In Bezug auf die gegebenen Anforderungen können die Dienste als gleichwertig betrachtet werden. Da \textit{Azure Functions} den Vorteil hat, dass es auch lokal entwickelt und getestet werden kann, wird dieser Dienst ausgewählt. Hierbei ist jedoch die nicht-funktionale Anforderung, dass aufgetretene Fehler leicht nachvollziehbar sein sollen, zu berücksichtigen, welche mit der aktuellen Auswahl nicht erfüllt wird. Diese Problematik kann durch die Ergänzung von \textit{Application Insight} gelöst werden. Dies ist ein Monitoring Dienst, der mit \textit{Azure Functions} verknüpft werden kann. Dadurch steht beim Programmieren der Funktionen ein Logger-Objekt zur Verfügung, welches Informationen oder Fehler an \textit{Application Insights} sendet. Dieses Logging ist über das \textit{Azure Portal} einsehbar. Außerdem können basierend auf den Logs automatische E-Mail-Benachrichtigungen gesendet werden \cite[vgl.][]{satapathi_hands-azure_2021}.
% adf braucht vms

Damit ist das Ergebnis der Evaluation, dass die Dienste \textit{Azure SQL Database}, \textit{Functions}, \textit{Application Insights}, \textit{Machine Learning}, \textit{Purview} und \textit{Power BI} zum Erfüllen der funktionalen Anforderungen eingesetzt werden sollen. 

\subsection{Vorstellung der Architektur}
Die Grundidee für die neue BI-Architektur wird in Abbildung~\ref{fig:chap03_4_konzeptArchitektur_offen} gezeigt. Neben den zuvor ausgewählten Ressourcen wurden die in Abschnitt~\ref{subsec:grundlagen:azure:sicherheitUndDatenschutz} vorgestellten Sicherheitsdienste ergänzt. Da \textit{Azure Policy} und das \ac{aad} Funktionen der \textit{Azure Cloud} sind, die implizit mit allen Ressourcen zusammenhängen, wurden zum Erhalten der Übersichtlichkeit keine Verbindungen eingezeichnet. Zum Verringern der Komplexität wurde Azure Machine Learning zunächst ausgelassen. Ein Ausblick auf eine mögliche Ergänzung wird in Abschnitt~\ref{sec:praktischeUmsetzung:ausblick:aml} gegeben.

\begin{figure}[htbp]
 \centering
 \includegraphics[width=\textwidth]{gfx/konzept_1.png}
 \caption{Vereinfachtes Konzept für BI-Architektur in Azure}
\label{fig:chap03_4_konzeptArchitektur_offen}
\end{figure}

Das Konzept lässt sich in fünf Aufgabenbereiche einteilen:
\begin{itemize}
\item \textbf{Datenintegration}: In \textit{Azure Functions} werden Funktionen implementiert, die sich mit den verschiedenen Quellsystemen verbinden, die Daten extrahieren, transformieren und in die \textit{SQL Database} laden. Passwörter und Schlüssel, die für die Authentifizierung benötigt werden, können dabei aus dem \textit{Key Vault} geladen werden. Bei der Ausführung werden ausführliche Logging-Informationen an \textit{Application Insisghts} gesendet. Beim Loggen eines Errors, wird automatisch eine E-Mail-Benachrichtigung versendet.
\item \textbf{Speicher} (\ac{dwh}): In die \textit{Azure SQL Database} werden alle Daten aus dem on-premise \ac{dwh} migriert. Damit ist sie der zentrale Speicherort im Cloud BI-System.
\item \textbf{Reporting}: Reports können zukünftig mit \textit{Power BI} erstellt und geteilt werden. Die verwendeten Daten werden aus dem Cloud \ac{dwh} geladen. 
\item \textbf{Datengovernance}: \textit{Azure Purview} sammelt Metadaten über die Datenlandschaft und erleichtert damit die Umsetzung eines DSGVO-konformen BI-Systems.
\item \textbf{Sicherheit}: Mit \textit{Azure Policy} wird verhindert, dass Ressourcen Konfiguration erhalten, die gegen eine Compliance verstoßen würden. Das \ac{aad} ist für die Authentifizierung und Autorisierung zuständig. Durch ein \ac{rbac}-Konzept wird sichergestellt, dass nur berechtige Personen Zugriff auf bestimmte Ressourcen oder Daten haben. 
\end{itemize}

Diese Architektur ist jedoch noch nicht ausreichend, um den Sicherheitsanforderungen gerecht zu werden, da vorausgesetzt wird, dass alle Ressourcen miteinander kommunizieren können. Dies ist nur der Fall, wenn auf schützende Firewall-Regeln verzichtet wird, was offensichtlich keine Option ist. Stattdessen sollen alle Ressourcen durch eine Firewall gesichert werden und die Kommunikation durch einige notwendige Ergänzungen ermöglicht werden. Das vollständige Konzept für die BI-Architektur, unter Berücksichtigung der Netzwerksicherheit, kann in Abbildung~\ref{fig:chap03_4_konzeptArchitektur} gefunden werden.
 
 \begin{figure}[htbp]
 \centering
 \includegraphics[width=\textwidth]{gfx/konzept_2.png}
 \caption{Konzept für BI-Architektur in Azure}
\label{fig:chap03_4_konzeptArchitektur}
\end{figure}

Die Grundlage bildet ein virtuelles Netzwerk für \textit{Azure Functions} und das \ac{dwh}. Mit einer zusätzlichen \ac{vm} in diesem virtuellen Netzwerk, auf der zwei Anwendungen installiert werden, kann es den Diensten \textit{Power BI} und \textit{Purview} ermöglicht werden, indirekt auf das geschützte \ac{dwh} zuzugreifen \cite[vgl.][]{gunnarsson_pro_2020, msdoc_22_purviewSHIR}. Für \textit{Azure Functions} wird eine statische IP-Adresse eingerichtet, sodass nur diese in Firewall-Einstellungen zugelassen werden muss. Wegen einer Unternehmensvorgabe darf die Firewall des on-premise Servers jedoch überhaupt nicht verändert werden. Die Datenintegration kann durch die Anwendung \textit{Hybrid Connection Manager} trotzdem ermöglicht werden, da damit nur noch ausgehende Verbindungen vom on-premise Server notwendig sind \cite[vgl.][]{msdoc_22_func_hybridConn}.