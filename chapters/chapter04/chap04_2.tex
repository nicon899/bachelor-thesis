\subsection{Konfiguration der Azure Ressourcen} \label{sec:umsetzen:konfiguration}

\subsubsection{Zentraler Datenspeicher} \label{subsec:umsetzen:konfiguration:datenspeicher}
Als zentraler Datenspeicher wird die \textit{Azure SQL Database} verwendet. Für diese stehen zwei Preismodelle zur Auswahl. Das anfänglich einzige, basiert auf DTUs (database transaction units), welche eine Kombination von Rechen-, Speicher- und I/O Ressourcen darstellen. Hierbei ist das Problem, dass keine unabhängige Skalierung möglich ist, falls zum Beispiel der Speicherbedarf überdurchschnittlich ist, aber kaum Rechenleistung benötigt wird. Das vCore-basierte Modell dagegen, ermöglicht diese unabhängige Skalierung und wird von Microsoft empfohlen. Aus diesen beiden Gründen soll hier das vCore-basierte Modell verwendet werden. Damit stehen drei Preisstufen zur Auswahl, wobei es sich im Zweifel empfiehlt zu Beginn die niedrigste zu wählen, da bei Bedarf jederzeit auf eine höhere umgestiegen werden kann. Für die niedrigste Stufe \textit{General Purpose} kann zwischen den Optionen \textit{Provisioned} und \textit{Serverless} für die Rechenressourcen gewählt werden. Bei \textit{Provisioned} werden die Rechenressourcen dauerhaft zur Verfügung gestellt. Das eignet sich besonders bei regelmäßiger Nutzung mit höherer Durchschnittsauslastung. Die serverlose Alternative skaliert die Ressourcen automatisch bei Bedarf und ist sinnvoll, wenn die Nutzung unvorhersehbar und unregelmäßig, dafür insgesamt jedoch geringer ist. Bei der Annahme, dass die Datenbank stündlich aktualisiert wird und anschließend die neuen Daten fürs Reporting gelesen werden, ist die erste Option voraussichtlich günstiger und wird deswegen gewählt. Als Collation wird die Variante \textit{SQL{\_}Latin1{\_}General{\_}CP1{\_}CI{\_}AS} festgelegt. Dieses spezifiziert neben dem Alphabet, das zum Sortieren verwendet werden soll, dass Akzente, jedoch nicht Groß- und Kleinschreibung, berücksichtigt werden. \cite[vgl.][]{mauri_azure_2021}

Neben der Datenbank muss ebenfalls ein Datenbankserver erstellt und angegeben werden. Hierbei handelt es sich nicht um eine SQL-Server Instanz, sondern nur um einen logischen Server mit Metadaten zur Verwaltung einer oder mehrerer \textit{Azure SQL-Datenbanken}. Für den Server wird ein Name und die Region angeben. Die Region des logischen Servers wird auch für alle zugehörigen Datenbanken übernommen. Für eine höhere Sicherheit wird hier außerdem festgelegt, dass die Authentifizierung für den Datenbankzugriff nur über das \ac{aad} erfolgen kann und es wird die Rolle \textit{Admin} aus dem \ac{aad} als Datenbankadministrator angegeben  \cite[vgl.][]{ward_azure_2021}.

\subsubsection{Sichere Aufbewahrung von Schlüsseln} \label{subsec:umsetzen:konfiguration:keyVault}
Für die gespeicherten Passwörter im \textit{Azure Key Vault} kann zwischen Hardware- und Softwaremodus entschieden werden. Bei beiden erfolgt die Speicherung auf einem Hardware-Sicherheitsmodul, jedoch werden nur beim Hardwaremodus alle Operationen, wie Ver- und Entschlüsselung, ebenfalls in diesen Modul durchgeführt. Damit verspricht der Hardwaremodus eine höhere Sicherheit, setzt jedoch die Premium-Variante des Key Vaults voraus. In der Premium-Variante stehen außerdem stärkere Schlüssel zur Verfügung \cite{haunts_key_2019}. Aus diesen Gründen wird hier die Premium, gegenüber der Standard~=Variante bevorzugt, da sie mehr Möglichkeiten, mit denen die Sicherheit weiter erhöht werden kann, bietet.

Die Verwendung von \ac{rbac} wird explizit festgelegt. Ansonsten würde ein eigenes Zugriffsrichtliniensystem des \textit{Key Vaults} verwendet werden. Anfragen aus nicht zugelassen Netzwerken sollen von der Firewall blockiert werden \cite[vgl.][]{herath_working_2022}.

\subsubsection{Datenintegration} \label{subsec:umsetzen:konfiguration:functions}
Damit \textit{Azure Functions} für den ETL-Prozess genutzt werden kann, wird eine Funktionsapp, als Container für die Funktionen erstellt. Für diese kann aus drei verschiedene Plänen gewählt werden. Im \textit{Verbrauchsplan} besteht keine Kontrolle über die verwendete Infrastruktur, sondern der Dienst skaliert automatisch nach Bedarf. Dadurch kann das zwischen Aufruf und Ausführung einer Funktion zu einer Verzögerung kommen. Die Kosten sind abhängig von der Ausführungsdauer der Funktionen. Beim \textit{Premiumplan} wird ebenfalls automatisch skaliert, es kann jedoch entsprechend der Leistungsanforderungen die eingesetzte Rechenleistung gewählt werden. Die Ressourcen sind bei diesem Plan jederzeit betriebsbereit, wodurch die Ausführung von Funktionen direkt bei Aufruf ohne Verzögerung beginnt. Der \textit{Dedizierte Plan} teilt der Funktionsapp feste Rechenressourcen zu, welche manuell oder automatisch skaliert werden können. Nur im Premium und dedizierten Plan ist es möglich ein virtuelles Netzwerk zu verwenden, weswegen der Verbrauchsplan hier nicht verwendet werden kann. Da die ETL-Prozesse nicht häufig ausgeführt werden, aber die Ausführungszeit vorrauschichtlich länger dauern kann, ist der \textit{Dedizierte Plan} hier die beste Option \cite[vgl.][]{satapathi_hands-azure_2021}. Die Runtime legt fest, in welcher Umgebung die Funktionen ausgeführt werden und damit auch die zu verwendende Programmiersprache. Da in Azure die \textit{C\# .NET} Runtime, laut einer von IEEE veröffentlichten Studie, die performanteste Option ist, soll diese für den ETL-Prozess verwendet werden \cite[vgl.][]{jackson_investigation_2018}. Des Weiteren wird ein \textit{Azure Storage Account} vorausgesetzt \textit{...}

Für den ausgehenden Datenverkehr soll eine statische IP-Adresse verwendet werden. Dafür wird ein Subnetz im virtuellen Netzwerk erstellt und verknüpft. In diesem Subnetz wird der Datenverkehr über ein NAT Gateway mit einer eigenen öffentlichen IP-Adresse weitergeleitet. Zusätzlich wird eine Funktionskonfiguration hinzugefügt, welche erzwingt, dass alle Funktionen ihren ausgehenden Datenverkehr über dieses NAT Gateway leiten \cite[vgl.][]{msdoc_22_func_ip}. Die statische IP-Adresse in den Netzwerkeinstellungen vom \textit{Azure Key Vault} und der Datenbank zu den zulässigen Adressen hinzugefügt. Für die Verbindung zu dem on-premise Server wird ein Relay erstellt. Dem Relay wird eine Hybridverbindung hinzugefügt, welche die Netzwerkadresse und den Port des lokalen Endpunkts definiert. Abschließend wird die Hybridverbindung mit der Funktionsapp verknüpft \cite[vgl.][]{msdoc_22_func_hybridConn}. Die Managed Identity der Funktionsapp bekommt eine Rolle zugewiesen, die es erlaubt, Werte aus dem \textit{Azure Key Vault} zu lesen.